### 防火墙基础原理



#### 防火墙

---

**包过滤防火墙**，给予ACL，通过检查数据流中每一个数据包的源IP地址、目的IP地址、源端口号、目的端口号、协议类型等因素或它们的组合来确定是否允许该数据包通过。

**代理防火墙** , 代理防火墙也叫应用层网关（Appliaction Gateway）防火墙。隔绝访问者与服务器直接建立连接。 

**状态监测防火墙**（发展史上的里程碑）， 一种能够提供**状态数据包检查**或**状态查看**功能的[防火墙](https://baike.baidu.com/item/防火墙)，能够持续追踪穿过这个防火墙的各种网络连接（例如[TCP](https://baike.baidu.com/item/TCP)与[UDP](https://baike.baidu.com/item/UDP)连接）的状态。这种防火墙被设计来区分不同连接种类下的合法数据包。只有匹配主动连接的数据包才能够被允许穿过防火墙，其他的数据包都会被拒绝。 

**统一威胁管理**，是指一个功能全面的安全产品，它能防范多种威胁。UTM产品通常包括防火墙，防病毒软件，内容过滤和垃圾邮件过滤器。 

**下一代防火墙**是一款可以全面应对应用层威胁的高性能[防火墙](https://baike.baidu.com/item/防火墙/52767)。通过深入洞察网络流量中的用户、应用和内容，并借助全新的高性能单路径异构并行处理[引擎](https://baike.baidu.com/item/引擎/2043)，NGFW能够为用户提供有效的应用层一体化安全防护，帮助用户安全地开展业务并简化用户的[网络安全](https://baike.baidu.com/item/网络安全/343664)架构。 



#### 防火墙的优缺点：

**包过滤**：

* 优点：

~~~
（1）包过滤防火墙对每条传入和传出网络的包实行低水平控制；

（2）包过滤防火墙检查每个IP包的字段，包括源地址、目的地址、协议、端口等，防火墙将基于这些信息应用过滤规则；

（3）包过滤防火墙可以识别和丢弃带欺骗性源IP地址的包；

（4） 包过滤防火墙对用户和应用透明，用户无需改变习惯，技术实现简单，运行速度快  

~~~

* 缺点：

~~~
（1）所有可能会用到的端口都必须静态放开。若允许建立HTTP 连接, 就需要开放1024 以上所有端口, 这增加了被攻击的可能性。
（2）包过滤防火墙不能对数据传输状态进行判断。如接收到一个ACK数据包, 就认为这是一个已建立的连接, 这会导致许多安全隐患, 一些恶意扫描和拒绝服务攻击就是利用了这个缺陷。
（3）包过滤防火墙无法过滤审核数据包上层的内容。即使通过防火墙的数据包有攻击性或包含病毒代码, 也无法进行控制和阻断。
~~~



---

**代理防火墙**

* 优点：

~~~
（1）应用层网关支持可靠的用户认证并提供详细的注册信息。
（2）用于应用层的过滤规则更易配置和测试。
（3）代理工作在客户机和真实服务器间，完全控制会话，可提供详细的日志和安全审计功能。
（4）应用代理防火墙可以被配置成唯一的可被外部看见的主机，从而隐藏内部网络的IP地址，保护内部主机免受外部主机进攻。
（5）通过代理访问因特网可以解决合法IP地址不够用的问题。
~~~



* 缺点：

~~~
（1）当用户对内部网络网关的吞吐量要求较高时，代理防火墙会成为内外网络间通信的瓶颈。
（2）应用代理服务器存在兼容性问题。代理服务器通常具有解释应用层命令的功能，因此，可能需要提供很多不同的代理服务器，而且每一种应用升级时，一般代理服务程序也要升级，所以能提供的服务和可伸缩性是有限的。
~~~



**状态检测防火墙**

* 优点：

~~~
（1）执行效率高：状态检测防火墙工作在协议栈的较低层，通过防火墙的所有的数据包都在低层处理，减少高层协议头的开销；此外防火墙中一个连接建立后不再需要对该连接进行其他处理。
（2）良好的伸缩性和扩展性：状态检测防火墙不区分每个具体的应用，动态产生新应用的新规则，无需重新编码。
（3）安全性高：状态检测防火墙检测所有应用层的数据包；此外状态检测防火墙还实现了基于UDP应用的安全，防火墙保存通过网关的每一个连接的状态信息，可以很好的降低拒绝服务和分布式拒绝服务攻击的风险。
~~~



* 缺点：

~~~
（1）状态检测防火墙虽然继承了包过滤防火墙和应用网关防火墙的优点，克服了它们的缺点，但它仍只是检测数据包的第三层信息，无法彻底的识别数据包中大量的垃圾邮件、广告以及木马程序等等。
（2）包过滤防火墙和网关代理防火墙以及状态检测防火墙都有固有的无法克服的缺陷，不能满足用户对于安全性的不断的要求，于是深度包检测防火墙技术被提出了
~~~



#### 防火墙特征：

* 逻辑区域过滤器。
* 隐藏内网网络结构。
* 自生安全保障。
* 主动防御攻击。



#### 防火墙安全域分类

**常用：**

* 非受信区域**Untrust**，低安全级别的安全区域，安全级别为5
* 非军事化区域**DMZ**，中等安全级别的安全域，安全级别为50
* 受信区域**Trust**，较高安全级别的安全域，安全级别为85

**传统：**

* l2trust
* l2untrust



#### 防火墙安全域的方向

* 入方向（Inbound）,报文从**低级别**的安全域向**高级别**的安全域流动。
* 出方向（Outbound）,报文从**高级别**的安全域向**低级别**的安全域流动。



#### 防火墙基本功能（深度检测技术）

&ensp; **深度报文检测（DPI）：**普通报文检测仅仅分析IP包的四层一下的内容，包括源地址、目的地址、源端口、目的端口以及协议类型，而DPI则在此基础上，增加了对应用层的分析，**可识别各种应用及其内容**。

&ensp; **深度数据流检测技术（DFI）：** 通过分析网络数据流量行为特征来识别网络应用。DFI 通过及时分析某种应用数据流和特征模型进行比较，因此检测的准确性取决于特征模型的准确性。

**DFI技术与DPI技术的区别**

1、处理速度

* DFI 不进行拆包操作，处理速度快。
* DPI 技术要逐包进行拆包操作，并于后台数据库进行对比，处理速度慢。

2、维护成本方面

* DFI 维护成本低
* 基于DPI技术的带宽管理系统需要配合新协议和新型应用，不断升级后台应用数据库，维护成本高。

3、识别准确率方面

* DPI 采用逐包分析、模式匹配技术，可以准确识别流量中的具体应用类型和协议。而DFI 仅对流量行为分析，只能对应用类型进行大致分类。
* 若数据包加密传输，采用DPI 方式的流控制技术则不能识别其具体应用，而DFI 方式的流控制技术则不受影响。





&ensp; 







